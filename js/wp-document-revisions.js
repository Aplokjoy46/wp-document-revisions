// Generated by CoffeeScript 1.4.0
(function(){var e,t=function(e,t){return function(){return e.apply(t,arguments)}};e=function(){function e(e){this.updateTimestamps=t(this.updateTimestamps,this),this.postAutosaveCallback=t(this.postAutosaveCallback,this),this.overrideLock=t(this.overrideLock,this),this.restoreRevision=t(this.restoreRevision,this),this.enableSubmit=t(this.enableSubmit,this),this.autosaveEnableButtons=t(this.autosaveEnableButtons,this),this.hijackAutosave=t(this.hijackAutosave,this),this.$=e,this.$(".revision").click(this.restoreRevision),this.$("#override_link").click(this.overrideLock),this.$("#document a").click(this.requestPermission),this.$(document).bind("autosaveComplete",this.postAutosaveCallback),this.$(document).bind("documentUpload",this.legacyPostDocumentUpload),this.$(":button, :submit","#submitpost").prop("disabled",!0),this.$("#misc-publishing-actions a").click(this.enableSubmit),this.$("input, select").on("change",this.enableSubmit),this.$("input[type=text], textarea").on("keyup",this.enableSubmit),this.bindPostDocumentUploadCB(),this.hijackAutosave(),setInterval(this.updateTimestamps,6e4)}return e.prototype.hasUpload=!1,e.prototype.window=window.dialogArguments||opener||parent||top,e.prototype.hijackAutosave=function(){return this.autosaveEnableButtonsOriginal=window.autosave_enable_buttons,window.autosave_enable_buttons=this.autosaveEnableButtons},e.prototype.autosaveEnableButtons=function(){this.$(document).trigger("autosaveComplete");if(this.hasUpload)return this.autosaveEnableButtonsOriginal()},e.prototype.enableSubmit=function(){return this.$(":button, :submit","#submitpost").removeAttr("disabled")},e.prototype.restoreRevision=function(e){e.preventDefault();if(confirm(wp_document_revisions.restoreConfirmation))return window.location.href=this.$(this).attr("href")},e.prototype.overrideLock=function(){return this.$.post(ajaxurl,{action:"override_lock",post_id:this.$("#post_ID").val()||0},function(e){return e?(this.$("#lock_override").hide(),this.$(".error").not("#lock-notice").hide(),this.$("#publish, .add_media, #lock-notice").fadeIn(),autosave()):alert(wp_document_revisions.lockError)})},e.prototype.requestPermission=function(){if(window.webkitNotifications!=null)return window.webkitNotifications.requestPermission()},e.prototype.lockOverrideNotice=function(e){return window.webkitNotifications.checkPermission()>0?window.webkitNotifications.RequestPermission(lock_override_notice):window.webkitNotifications.createNotification(wp_document_revisions.lostLockNoticeLogo,wp_document_revisions.lostLockNoticeTitle,e).show()},e.prototype.postAutosaveCallback=function(){if(this.$("#autosave-alert").length>0&&this.$("#lock-notice").length>0&&this.$("#lock-notice").is(":visible"))return wp_document_revisions.lostLockNotice=wp_document_revisions.lostLockNotice.replace("%s",this.$("#title").val()),window.webkitNotifications?lock_override_notice(wp_document_revisions.lostLockNotice):alert(wp_document_revisions.lostLockNotice),location.reload(!0)},e.prototype.legacyPostDocumentUpload=function(e,t){return this.postDocumentUpload(e,t)},e.prototype.human_time_diff=function(e,t){var n,r,i,s,o;n=new Date,t=t||n.getTime()/1e3+parseInt(wp_document_revisions.offset),i=Math.abs(t-e);if(i<=3600)return o=Math.floor(i/60),o=this.roundUp(o),o===1?wp_document_revisions.minute.replace("%d",o):wp_document_revisions.minutes.replace("%d",o);if(i<=86400&&i>3600)return s=Math.floor(i/3600),s=this.roundUp(s),s===1?wp_document_revisions.hour.replace("%d",s):wp_document_revisions.hours.replace("%d",s);if(i>=86400)return r=Math.floor(i/86400),r=this.roundUp(r),r===1?wp_document_revisions.day.replace("%d",r):wp_document_revisions.days.replace("%d",r)},e.prototype.roundUp=function(e){return e<1&&(e=1),e},e.prototype.bindPostDocumentUploadCB=function(){var e=this;if(typeof uploader=="undefined"||uploader===null)return;return uploader.bind("FileUploaded",function(t,n,r){if(r.response.match("media-upload-error"))return;return e.postDocumentUpload(n.name,r.response)})},e.prototype.updateTimestamps=function(){var e=this;return this.$(".timestamp").each(function(){return e.$(e).text(e.human_time_diff(e.$(e).attr("id")))})},e.prototype.postDocumentUpload=function(e,t){if(typeof t=="string"&&t.indexOf("error")!==-1)return this.$(".media-item:first").html(t);e instanceof Object&&(e=e.name.split(".").pop());if(this.hasUpload)return;this.window.jQuery("#content").val(t),this.window.jQuery("#message").hide(),this.window.jQuery("#revision-summary").show(),this.window.jQuery(":button, :submit","#submitpost").removeAttr("disabled"),this.hasUpload=!0,this.window.tb_remove(),typeof convertEntities=="function"&&(wp_document_revisions.postUploadNotice=convertEntities(wp_document_revisions.postUploadNotice)),this.window.jQuery("#post").before(wp_document_revisions.postUploadNotice).prev().fadeIn().fadeOut().fadeIn();if(this.window.jQuery("#sample-permalink").length!==0)return this.window.jQuery("#sample-permalink").html(this.window.jQuery("#sample-permalink").html().replace(/\<\/span>(\.[a-z0-9]{3,4})?@$/i,wp_document_revisions.extension))},e}(),jQuery(document).ready(function(t){return window.WPDocumentRevisions=new e(t)})}).call(this);